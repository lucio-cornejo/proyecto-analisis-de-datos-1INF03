<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.180">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="dcterms.date" content="2022-06-30">
  <title>Informe final</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="index_files/libs/clipboard/clipboard.min.js"></script>
  <script src="index_files/libs/quarto-html/quarto.js"></script>
  <script src="index_files/libs/quarto-html/popper.min.js"></script>
  <script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="index_files/libs/quarto-html/anchor.min.js"></script>
  <link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Tabla de contenido</h2>
<ul>
<li><a href="#integrantes" class="nav-link active" data-scroll-target="#integrantes">Integrantes</a></li>
<li><a href="#paso-3-entendimiento-de-los-datos" class="nav-link" data-scroll-target="#paso-3-entendimiento-de-los-datos">Paso 3: Entendimiento de los datos</a>
<ul class="collapse">
<li><a href="#datos-duplicados" class="nav-link" data-scroll-target="#datos-duplicados">Datos duplicados</a></li>
<li><a href="#datos-vacíos" class="nav-link" data-scroll-target="#datos-vacíos">Datos vacíos</a></li>
<li><a href="#medidas-de-resumen-para-variables-numericas" class="nav-link" data-scroll-target="#medidas-de-resumen-para-variables-numericas">Medidas de resumen para variables numericas</a></li>
<li><a href="#medidas-de-resumen-para-variables-categóricas" class="nav-link" data-scroll-target="#medidas-de-resumen-para-variables-categóricas">Medidas de resumen para variables categóricas</a></li>
<li><a href="#tratamiento-de-datos-atípicos-y-estadísticas-descriptivas" class="nav-link" data-scroll-target="#tratamiento-de-datos-atípicos-y-estadísticas-descriptivas"><strong>Tratamiento de Datos Atípicos y Estadísticas Descriptivas</strong></a>
<ul class="collapse">
<li><a href="#datos-numéricos" class="nav-link" data-scroll-target="#datos-numéricos">Datos numéricos</a></li>
</ul></li>
<li><a href="#imputación" class="nav-link" data-scroll-target="#imputación">Imputación</a>
<ul class="collapse">
<li><a href="#imputar-valores-para-la-columna-valence" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-valence">Imputar valores para la columna valence</a></li>
<li><a href="#imputar-valores-para-la-columna-tempo" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-tempo">Imputar valores para la columna tempo</a></li>
<li><a href="#imputar-valores-para-la-columna-loudness" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-loudness">Imputar valores para la columna loudness</a></li>
<li><a href="#imputar-valores-para-la-columna-duration_ms" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-duration_ms">Imputar valores para la columna duration_ms</a></li>
<li><a href="#imputar-valores-para-la-columna-liveness" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-liveness">Imputar valores para la columna liveness</a></li>
<li><a href="#imputar-valores-para-la-columna-speechiness" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-speechiness">Imputar valores para la columna speechiness</a></li>
<li><a href="#imputar-valores-para-la-columna-instrumentalness" class="nav-link" data-scroll-target="#imputar-valores-para-la-columna-instrumentalness">Imputar valores para la columna instrumentalness</a></li>
<li><a href="#validar-la-imputación" class="nav-link" data-scroll-target="#validar-la-imputación">Validar la imputación</a></li>
</ul></li>
<li><a href="#transformación-de-variables" class="nav-link" data-scroll-target="#transformación-de-variables">Transformación de variables</a>
<ul class="collapse">
<li><a href="#name" class="nav-link" data-scroll-target="#name">name</a></li>
<li><a href="#release_date" class="nav-link" data-scroll-target="#release_date">release_date</a></li>
<li><a href="#time_signature" class="nav-link" data-scroll-target="#time_signature">time_signature</a></li>
</ul></li>
<li><a href="#popularity" class="nav-link" data-scroll-target="#popularity">Popularity</a></li>
<li><a href="#key" class="nav-link" data-scroll-target="#key">Key</a>
<ul class="collapse">
<li><a href="#analisis-de-correlación" class="nav-link" data-scroll-target="#analisis-de-correlación">Analisis de correlación</a></li>
</ul></li>
</ul></li>
<li><a href="#paso-4-data-mining" class="nav-link" data-scroll-target="#paso-4-data-mining">Paso 4: Data mining</a>
<ul class="collapse">
<li><a href="#separar-en-variable-dependiente-y-variable-independiente" class="nav-link" data-scroll-target="#separar-en-variable-dependiente-y-variable-independiente">Separar en variable dependiente y variable independiente</a></li>
<li><a href="#sample-splitting" class="nav-link" data-scroll-target="#sample-splitting">Sample splitting</a></li>
<li><a href="#balanceo-de-datos" class="nav-link" data-scroll-target="#balanceo-de-datos">Balanceo de Datos</a></li>
<li><a href="#árbol-de-clasificación-cart" class="nav-link" data-scroll-target="#árbol-de-clasificación-cart">Árbol de clasificación CART</a>
<ul class="collapse">
<li><a href="#generamos-arboles-de-decision-con-datos-balanceados-y-sin-balancear" class="nav-link" data-scroll-target="#generamos-arboles-de-decision-con-datos-balanceados-y-sin-balancear">Generamos arboles de decision con datos balanceados y sin balancear</a></li>
</ul></li>
<li><a href="#regresión-logísitica" class="nav-link" data-scroll-target="#regresión-logísitica">Regresión logísitica</a></li>
<li><a href="#análisis-de-los-modelos" class="nav-link" data-scroll-target="#análisis-de-los-modelos">Análisis de los modelos</a>
<ul class="collapse">
<li><a href="#modelo-de-regresión-logística" class="nav-link" data-scroll-target="#modelo-de-regresión-logística">Modelo de regresión logística</a></li>
<li><a href="#modelo-de-árbol-de-clasificación-cart-sin-balanceo-de-datos" class="nav-link" data-scroll-target="#modelo-de-árbol-de-clasificación-cart-sin-balanceo-de-datos">Modelo de árbol de clasificación CART sin balanceo de datos</a></li>
<li><a href="#modelo-de-árbol-de-clasificación-cart-con-balanceo-de-datos" class="nav-link" data-scroll-target="#modelo-de-árbol-de-clasificación-cart-con-balanceo-de-datos">Modelo de árbol de clasificación CART con balanceo de datos</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</div>
<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">


<div class="quarto-title"><h1 class="title display-7">Informe final</h1></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Published</div><div class="quarto-title-meta-contents"><p class="date">June 30, 2022</p></div></div></div></header>

<section id="integrantes" class="level2">
<h2 class="anchored" data-anchor-id="integrantes">Integrantes</h2>
<ul>
<li>Andrea Mejia</li>
<li>Renzo Richle</li>
<li>Lucio Cornejo</li>
<li>Claudia Vivas</li>
</ul>
<ol type="1">
<li><a href="#paso-2">Paso 2</a>
<ul>
<li><a href="#adquisicion-de-datos">Adquisición de Datos</a></li>
</ul></li>
<li><a href="#paso-3">Paso 3</a>
<ul>
<li><a href="#entendimiento-de-los-datos">Entendimiento de los datos</a></li>
<li><a href="#duplicados">Duplicados</a></li>
<li><a href="#vacios">Vacios</a></li>
<li><a href="#medidas-de-resumen-para-variables-numericas">Medidas de resumen para variables numéricas</a></li>
<li><a href="#medidas-de-resumen-para-variables-categoricas">Medidas de resumen para variables categóricas</a></li>
<li><a href="#tratamiento-de-datos-atipicos">Tratamiento de datos atípicos</a>
<ul>
<li><a href="#outliers-por-exceso">Outliers por exceso</a></li>
<li><a href="#outliers-por-defecto">Outliers por defecto</a></li>
<li><a href="#separar-la-base-en-atipicos-y-no-atipicos">Separar la base en atipicos y no atipicos</a></li>
</ul></li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos la base de datos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tracks = pd.read_csv(r'E:\Documentos\Github\proyecto-analisis-de-datos-1INF03\datos\tracks.csv')</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>tracks <span class="op">=</span> pd.read_csv(<span class="vs">r'F:\2022-1\Analisis de datos\Tarea Academica\archive\tracks.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tracks = pd.read_csv("../datos/tracks.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tracks.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notamos que algunas de las columnas nos generan la misma información, pese a su presentación diferente.</p>
<p>Por ejemplo, la variable <strong>id_artists</strong> es un identificador único por artista, así que nos proporciona casi completamente la misma información que la variable <strong>artists</strong> (nombre del artista).</p>
<p>Análogamente sucede para las variables <strong>id</strong> (identificador de la canción) y <strong>name</strong> (nombre de la canción).</p>
<p>Sin embargo, debido a la posibilidad de que existan canciones con el mismo nombre, o artistas con el mismo nombre <em>musical</em>, no descartaremos, por ahora, a las columnas <strong>id</strong> e <strong>id_artists</strong>, en caso resulten necesarias más adelante en el análisis.</p>
</section>
<section id="paso-3-entendimiento-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="paso-3-entendimiento-de-los-datos">Paso 3: Entendimiento de los datos</h2>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos datos tras paso 2</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>tracks <span class="op">=</span> pd.read_csv(<span class="vs">r'E:\Documentos\Github\proyecto-analisis-de-datos-1INF03\datos\tracks.csv'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># tracks = pd.read_csv(r'F:\2022-1\Analisis de datos\Tarea Academica\archive\tracks.csv')</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tracks = pd.read_csv("../datos/tracks.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'La base tiene'</span>, tracks.shape[<span class="dv">0</span>], <span class="st">'filas y'</span>, tracks.shape[<span class="dv">1</span>], <span class="st">'columnas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Las columnas se la base se llaman:'</span>, tracks.columns.to_list())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tracks.dtypes</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Se tiene los siguientes tipos de datos por columna: </span><span class="ch">\n</span><span class="st">'</span>,tracks.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descripción de los datos</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tracks.info()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(tracks.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos la variable 'release_date', de object a datetime64[ns]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tracks[<span class="st">'release_date'</span>] <span class="op">=</span> pd.to_datetime(tracks[<span class="st">'release_date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Eliminaremos la columna de ‘artists’ ya que no presenta información relevante para el modelo debido a que se cuenta con la columna id_artists que guardaría la información de los artistas por lo que se estaría duplicando esta información</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tracks.shape)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tracks.drop([<span class="st">"artists"</span>], axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tracks.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="datos-duplicados" class="level3">
<h3 class="anchored" data-anchor-id="datos-duplicados">Datos duplicados</h3>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Como cada fila de este dataset corresponde a una canción diferente,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># omitimos los duplicados vía el identificador de cada canción</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tracks.shape)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>tracks.drop_duplicates(subset <span class="op">=</span> <span class="st">'id'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tracks.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se observa que los datos no tienen filas con valores duplicados, es decir, no existen registros repetidos.</p>
</section>
<section id="datos-vacíos" class="level3">
<h3 class="anchored" data-anchor-id="datos-vacíos">Datos vacíos</h3>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contabilizamos vacíos</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>vacios <span class="op">=</span> pd.DataFrame(tracks.isnull().<span class="bu">sum</span>()).sort_values(<span class="dv">0</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>vacios.columns <span class="op">=</span> [<span class="st">'vacios'</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>vacios[<span class="st">'vacios%'</span>] <span class="op">=</span> <span class="bu">round</span>(vacios[<span class="st">'vacios'</span>]<span class="op">/</span>tracks.shape[<span class="dv">0</span>], <span class="dv">2</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>vacios</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Encontramos que solo la columna “name” almacena valores vacios, en particular, 71.</p>
<p>Como se comentó en el paso dos, es posible que la columna “name” se trate de un identificador. Asimismo, la información de la columna “id” identifica a las canciones, así que, como la variable “id” <strong>no presenta valores vacíos</strong>, no es necesario remover las filas asociadas a valores vacíos de la columna “name”.</p>
<p>Más bien, basta descartar a la columna “name”, pues su información podemo obtenerla vía la variable “id”.</p>
</section>
<section id="medidas-de-resumen-para-variables-numericas" class="level3">
<h3 class="anchored" data-anchor-id="medidas-de-resumen-para-variables-numericas">Medidas de resumen para variables numericas</h3>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separación de variables en numéricas y categóricas</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dfnum <span class="op">=</span> tracks.select_dtypes(include <span class="op">=</span> [<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dfcat <span class="op">=</span> tracks.select_dtypes(exclude <span class="op">=</span> [<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Variables categóricas'</span>, dfcat.shape)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Variables numéricas'</span>, dfnum.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadisticos desciptivas para las variables numéricas</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dfnum.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribuciones de los datos numéricos</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>columnas_numericas <span class="op">=</span> dfnum.columns.tolist()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style <span class="op">=</span> <span class="st">"darkgrid"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas_numericas:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  sns.distplot(dfnum[col])</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  plt.title(col)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note entonces que las variables <strong>explicit</strong>, <strong>key</strong>, <strong>mode</strong> y <strong>time_signature</strong> no parecen ser variables numéricas.</p>
<p>En base a la descripción de tales variabes, como se observa en la tabla presentada en el paso 2, convertiremos aquellas tres variables a strings, por tratarse de valores categóricos.</p>
<p>En particular, la variable <strong>explicit</strong> es un boolean.</p>
<p>Por ello, volvemos a separar en dos grupos a las variables del dataset en original.</p>
<p>Asimismo, en base a la presencia de colas de gran longitud (respecto al rango de las variables), conviene trabajar más bien con el logaritmo de las variables numéricas <strong>duration_ms, speechiness, instrumentalness</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Antes de tomar logaritmo, revisemos que es</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># matematicamente correcto emplear tal función</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.duration_ms <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.speechiness <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.instrumentalness <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.duration_ms <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.speechiness <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((tracks.instrumentalness <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sabemos que las variables <strong>speechiness</strong> e <strong>instrumentalness</strong> están en el rango [0; 1], valiendo 0 para algunas observaciones.</p>
<p>Entonces, añadiremos 0.001 a los valores en tales columnas, para poder emplear logaritmo.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"duration_ms"</span>, <span class="st">"speechiness"</span>, <span class="st">"instrumentalness"</span>]:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  tracks[col] <span class="op">=</span> tracks[col] <span class="op">+</span> <span class="fl">0.001</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  tracks[col] <span class="op">=</span> np.log10(tracks[col])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable explicit</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tracks[[<span class="st">"explicit"</span>]].value_counts())</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Como tal variable vale 0 o 1, y, según su definición</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># es de tipo boolean, no es necesario convertirla a boolean.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># La convertirmos a string para separar la data en variables</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># númericas y categóricas.</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables string</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>tracks[[<span class="st">"key"</span>, <span class="st">"mode"</span>, <span class="st">"time_signature"</span>, <span class="st">"explicit"</span>]] <span class="op">=</span> tracks[[<span class="st">"key"</span>, <span class="st">"mode"</span>, <span class="st">"time_signature"</span>, <span class="st">"explicit"</span>]].astype(<span class="st">'string'</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># División de variables numéricas y categóricas</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>dfnum <span class="op">=</span> tracks.select_dtypes(include <span class="op">=</span> [<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>dfcat <span class="op">=</span> tracks.select_dtypes(exclude <span class="op">=</span> [<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Nuevas dimensiones</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Variables categóricas'</span>, dfcat.shape)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Variables numéricas'</span>, dfnum.shape)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar data frames previo a imputación</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>dfnum.to_csv(<span class="st">"../datos/dfnum_pre_imp.csv"</span>, index <span class="op">=</span> <span class="va">False</span>, sep <span class="op">=</span> <span class="st">","</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>dfcat.to_csv(<span class="st">"../datos/dfcat.csv"</span>, index <span class="op">=</span> <span class="va">False</span>, sep <span class="op">=</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="medidas-de-resumen-para-variables-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="medidas-de-resumen-para-variables-categóricas">Medidas de resumen para variables categóricas</h3>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos las variables, posiblemente idénticas en </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># información, "id" y "name"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> dfcat.columns[<span class="dv">0</span>:<span class="dv">2</span>]:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(dfcat[columna].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notamos entonces que la variable <strong>name</strong> presenta repeticiones en algunas de sus categorías.</p>
<p>En base a lo explicado , optaremos por descartar, más adelante, la columna <strong>name</strong>,</p>
<p>porque realizaremos algunas transformaciones para este dato, con fin exploratorio de la data.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dfcat.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como las variables <strong>id</strong> e <strong>id_artists</strong> son Identificadores, no vale la pena describir sus estadísticos.</p>
<p>Consideremos entonces solo a las variables categóricas <strong>release_date</strong>, <strong>key</strong>, <strong>mode</strong> y <strong>time_signature</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> [<span class="st">"explicit"</span>, <span class="st">"key"</span>, <span class="st">"mode"</span>, <span class="st">"time_signature"</span>]:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">100</span> <span class="op">*</span> dfcat[columna].value_counts() <span class="op">/</span> <span class="bu">len</span>(dfcat[columna])).plot(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="ss">f"Porcentajes respecto a </span><span class="sc">{</span>columna<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    rot <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tratamiento-de-datos-atípicos-y-estadísticas-descriptivas" class="level3">
<h3 class="anchored" data-anchor-id="tratamiento-de-datos-atípicos-y-estadísticas-descriptivas"><strong>Tratamiento de Datos Atípicos y Estadísticas Descriptivas</strong></h3>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficamos los boxplots de las variables numéricas</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> dfnum.columns.to_list()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> columnas:</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  dfnum.boxplot(column <span class="op">=</span> columna)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  plt.title(columna)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Respecto a la manera estándar pata calcular valores atípicos, se observa que casi todas las filas numéricas presentarían outliers. Sin embargo, aquel criterio estándar es de utilidad cuando la variable analizada posee una distribución aproximadamente gaussiana.</p>
<p>Por ello, generemos <strong>Q-Q plots</strong> para darnos una idea de qué tan gaussianas son las distribuciones de nuestras variables numéricas.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pylab </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># La funcion select_dtypes genera un data frame formado únicamente por</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># columnas del tipo indicado como argumento</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> dfnum.select_dtypes(<span class="st">'number'</span>).columns:</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  stats.probplot(dfnum[col], dist <span class="op">=</span> <span class="st">"norm"</span>, plot <span class="op">=</span> plt)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  plt.title(col)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  pylab.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se observa que las variables no siguen una distribución gaussiana.</p>
<p>Por ello, en este contexto, el tratamiento de outliers debería ser revisando variable por variable.</p>
<section id="datos-numéricos" class="level4">
<h4 class="anchored" data-anchor-id="datos-numéricos">Datos numéricos</h4>
<p>El tratamiento de los whiskers para las variables numéricos lo realizamos de manera interactiva, vía la aplicación creada por el documento <strong>custom-whiskers.qmd</strong> presente en esta misma carpeta.</p>
<p>A continuación, graficaremos los resultados obtenidos vía tal aplicación, habiendo analizado caso por caso las variables en <strong>dfnum</strong>, con el fin de determinar whiskers apropiados que nos permitan identificar valores atipicos.</p>
<p>Tales valores atípicos los definimos de manera que realmente se alejen de la mediana o media de la variable analizada, y que el porcentaje de valores atípicos obtenido no supere el 10% del total de datos, debido a que sino más adelante imputaríamos un porcentaje significativo de la data de cada variable numérica, creando así mucha información ficticia para los modelos predictivos a emplearse.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">variable</th>
<th style="text-align: center;">whisker inferior</th>
<th style="text-align: center;">whisker superior</th>
<th style="text-align: center;">% por imputar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">duration_ms</td>
<td style="text-align: center;">4.7</td>
<td style="text-align: center;">5.9</td>
<td style="text-align: center;">1.13</td>
</tr>
<tr class="even">
<td style="text-align: center;">danceability</td>
<td style="text-align: center;">0.04</td>
<td style="text-align: center;">0.99</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">energy</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">loudness</td>
<td style="text-align: center;">-30</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.44</td>
</tr>
<tr class="odd">
<td style="text-align: center;">speechiness</td>
<td style="text-align: center;">-1.65</td>
<td style="text-align: center;">-0.185</td>
<td style="text-align: center;">3.93</td>
</tr>
<tr class="even">
<td style="text-align: center;">acousticness</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: center;">instrumentalness</td>
<td style="text-align: center;">-3.15</td>
<td style="text-align: center;">-0.05</td>
<td style="text-align: center;">4.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">liveness</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.7</td>
<td style="text-align: center;">3.89</td>
</tr>
<tr class="odd">
<td style="text-align: center;">valence</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: center;">tempo</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">210</td>
<td style="text-align: center;">0.26</td>
</tr>
</tbody>
</table>
<p>Aclaramos que el <strong>porcentaje por imputar</strong> presente en la tabla previa es en realidad una aproximación (muy buena, pero no exacta) del verdadero porcentaje por imputar.</p>
<p>Por ejemplo, como los valores de <strong>energy</strong> están, por definición, entre 0 y 1, en realidad en tal caso no se realizará imputación.</p>
<p>Sin embargo, hemos tenido esa situación en cuenta para los códigos siguientes a emplear.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable: [whisker_inferior, whisker_superior, %_a_imputar]</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>custom_whiskers <span class="op">=</span> {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"duration_ms"</span>: [<span class="fl">4.7</span>, <span class="fl">5.9</span>, <span class="fl">1.13</span>],</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"danceability"</span>: [<span class="fl">0.04</span>, <span class="fl">0.99</span>, <span class="fl">0.06</span>],</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"energy"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>],</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"loudness"</span>: [<span class="op">-</span><span class="dv">30</span>, <span class="dv">0</span>, <span class="fl">0.44</span>],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"speechiness"</span>: [<span class="op">-</span><span class="fl">1.65</span>, <span class="op">-</span><span class="fl">0.185</span>, <span class="fl">3.93</span>],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"acousticness"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>],</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"instrumentalness"</span>: [<span class="op">-</span><span class="fl">3.15</span>, <span class="op">-</span><span class="fl">0.05</span>, <span class="fl">4.1</span>],</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"liveness"</span>: [<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">3.89</span>],</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"valence"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.06</span>],</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tempo"</span>: [<span class="dv">50</span>, <span class="dv">210</span>, <span class="fl">0.26</span>],</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de las distribuciones, con los </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whiskers (en amarillos) obtenidos</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> grafica_custom_whiskers(columna):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  sns.distplot(dfnum[columna])</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rectas verticales para la media y mediana</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  plt.axvline(dfnum[columna].mean(), color <span class="op">=</span> <span class="st">"red"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  plt.axvline(dfnum[columna].median(), color <span class="op">=</span> <span class="st">"green"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cuartiles usuales</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  plt.axvline(dfnum[columna].quantile(<span class="fl">0.25</span>), color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  plt.axvline(dfnum[columna].quantile(<span class="fl">0.75</span>), color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>) </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Whiskers escogidos</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  whisker_superior <span class="op">=</span> custom_whiskers[columna][<span class="dv">0</span>]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  whisker_inferior <span class="op">=</span> custom_whiskers[columna][<span class="dv">1</span>]</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  porcentaje_por_imputar <span class="op">=</span> custom_whiskers[columna][<span class="dv">2</span>]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  plt.axvline(whisker_superior, color <span class="op">=</span> <span class="st">"yellow"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>) </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  plt.axvline(whisker_inferior, color <span class="op">=</span> <span class="st">"yellow"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>) </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  plt.title(<span class="ss">f"Proporción aproximada por imputar: </span><span class="sc">{</span>porcentaje_por_imputar<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> <span class="bu">list</span>(custom_whiskers.keys()):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  grafica_custom_whiskers(columna)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener índices de los valores atípicos</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> indices_outliers(columna):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  outliersInf <span class="op">=</span> (dfnum[columna] <span class="op">&lt;</span> custom_whiskers[columna][<span class="dv">0</span>])</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  outliersInf <span class="op">=</span> outliersInf[outliersInf <span class="op">==</span> <span class="va">True</span>].index.to_list()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  outliersSup <span class="op">=</span> (dfnum[columna] <span class="op">&gt;</span> custom_whiskers[columna][<span class="dv">1</span>])   </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  outliersSup <span class="op">=</span> outliersSup[outliersSup <span class="op">==</span> <span class="va">True</span>].index.to_list()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (outliersSup <span class="op">+</span> outliersInf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener los índices de los outliers en dfnum</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> dfnum.copy()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> <span class="bu">list</span>(custom_whiskers.keys()):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  dfnum_sin_outliers.loc[indices_outliers(columna), columna] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Revisamos la conversión de datos atípicos a vacíos (pd.NA),</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># y hallamos la proporción de vacíos en la data</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>vacios <span class="op">=</span> pd.DataFrame(dfnum_sin_outliers.isnull().<span class="bu">sum</span>()).sort_values(<span class="dv">0</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>vacios.columns <span class="op">=</span> [<span class="st">'vacios'</span>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>vacios[<span class="st">'vacios%'</span>] <span class="op">=</span> <span class="bu">round</span>(vacios[<span class="st">'vacios'</span>] <span class="op">/</span> dfnum.shape[<span class="dv">0</span>], <span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>vacios </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="imputación" class="level3">
<h3 class="anchored" data-anchor-id="imputación">Imputación</h3>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> KNNImputer(n_neighbors <span class="op">=</span> <span class="dv">5</span>, weights <span class="op">=</span> <span class="st">"uniform"</span>, metric <span class="op">=</span> <span class="st">"nan_euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como tenemos un dataset bastante grande la imputación de datos va a irse trabajando columna a columna para que pueda ser procesado sin tomar tanto tiempo</p>
<section id="imputar-valores-para-la-columna-valence" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-valence">Imputar valores para la columna valence</h4>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>]] <span class="op">=</span> imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-tempo" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-tempo">Imputar valores para la columna tempo</h4>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>]]<span class="op">=</span>imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numba <span class="im">import</span> jit, cuda    </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function optimized to run on gpu  </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>jit(target <span class="op">=</span><span class="st">"cuda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-loudness" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-loudness">Imputar valores para la columna loudness</h4>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>]]<span class="op">=</span>imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-duration_ms" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-duration_ms">Imputar valores para la columna duration_ms</h4>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>]]<span class="op">=</span>imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-liveness" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-liveness">Imputar valores para la columna liveness</h4>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>]]<span class="op">=</span>imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-speechiness" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-speechiness">Imputar valores para la columna speechiness</h4>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>,<span class="st">"speechiness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>,<span class="st">"speechiness"</span>]]<span class="op">=</span>imputer.transform(dfnum_sin_outliers[[<span class="st">"popularity"</span>,<span class="st">"energy"</span>,<span class="st">"acousticness"</span>,<span class="st">"valence"</span>,<span class="st">"danceability"</span>,<span class="st">"tempo"</span>,<span class="st">"loudness"</span>,<span class="st">"duration_ms"</span>,<span class="st">"liveness"</span>,<span class="st">"speechiness"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputar-valores-para-la-columna-instrumentalness" class="level4">
<h4 class="anchored" data-anchor-id="imputar-valores-para-la-columna-instrumentalness">Imputar valores para la columna instrumentalness</h4>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Para esta ultima columna ya se podría usar todas las otras columnas para calcular el valor de los outliers porque ya no tienen vacios</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>imputer.fit(dfnum_sin_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> imputer.transform(dfnum_sin_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validar-la-imputación" class="level4">
<h4 class="anchored" data-anchor-id="validar-la-imputación">Validar la imputación</h4>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> pd.DataFrame(dfnum_sin_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.columns <span class="op">=</span> columnas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Revisamos la conversión de vacios por medio del metodo de imputacion KNN</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#No deberian haber vacios en el dataset</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>vacios <span class="op">=</span> pd.DataFrame(dfnum_sin_outliers.isnull().<span class="bu">sum</span>()).sort_values(<span class="dv">0</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>vacios.columns <span class="op">=</span> [<span class="st">'vacios'</span>]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>vacios[<span class="st">'vacios%'</span>] <span class="op">=</span> <span class="bu">round</span>(vacios[<span class="st">'vacios'</span>] <span class="op">/</span> dfnum.shape[<span class="dv">0</span>], <span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>vacios </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos los datos sin imputar outliers en otra variable </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># para comprobar mediante el test Kolmogorov-Smirnov que tiene la misma distribución que la data imputada </span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># y así confirmar que es un buen método de imputación</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test <span class="op">=</span> dfnum.copy()</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> columna <span class="kw">in</span> <span class="bu">list</span>(custom_whiskers.keys()):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  dfnum_sin_outliers_test.loc[indices_outliers(columna), columna] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos los datos sin outliers</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.to_csv(<span class="st">'dfnum_sin_outliers.csv'</span>, index <span class="op">=</span> <span class="va">False</span>, sep<span class="op">=</span><span class="st">','</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También se puede acceder a la data imputada vía el siguiente <a href="https://drive.google.com/drive/folders/17FhWbmf-yrM_O8_6QcMLvTLurjviZqyu">link</a>, archivo <strong>dfnum_sin_outliers.csv</strong> .</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos a numpy para poder usar el test </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test <span class="op">=</span> dfnum_sin_outliers_test.to_numpy()</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> dfnum_sin_outliers.to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># El test solo admite arreglos de una dimensión</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test <span class="op">=</span> dfnum_sin_outliers_test.flatten()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dfnum_sin_outliers_test.shape)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> dfnum_sin_outliers.flatten()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dfnum_sin_outliers.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ks_2samp</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ks_2samp(dfnum_sin_outliers, dfnum_sin_outliers_test)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos </span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># KstestResult(statistic=0.012532169129040982, pvalue=0.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Según el resultado del test, las distribuciones no son idénticas (columna por columna), pero analizaremos las gráficas para comprobar si las distribuciones son parecidas.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regresamos a dataframe para hacer gráficas y comparar</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data sin imputar</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test <span class="op">=</span> np.resize(dfnum_sin_outliers_test,(<span class="dv">586672</span>,<span class="dv">11</span>))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test <span class="op">=</span> pd.DataFrame(dfnum_sin_outliers_test)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test.columns <span class="op">=</span> columnas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data despues de imputar</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> np.resize(dfnum_sin_outliers,(<span class="dv">586672</span>,<span class="dv">11</span>))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers <span class="op">=</span> pd.DataFrame(dfnum_sin_outliers)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.columns <span class="op">=</span> columnas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfica color azul: Datos sin imputar</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfica color naranja: Datos imputados</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style <span class="op">=</span> <span class="st">"darkgrid"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  sns.distplot(dfnum_sin_outliers_test[col])</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  sns.distplot(dfnum_sin_outliers[col])</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  plt.title(col)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dfnum_sin_outliers_test.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En el análisis estadístico gráfico y descriptivo, se observa que las distribuciones de las variables imputadas y sin imputar son casi iguales. Por ello, pese al resultado obtenido con el test de Kolmogorov-Smirnov, concluimos que la imputación ha sido exitosa.</p>
</section>
</section>
<section id="transformación-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="transformación-de-variables">Transformación de variables</h3>
<section id="name" class="level4">
<h4 class="anchored" data-anchor-id="name">name</h4>
<p>Incluir métricas sobre name para tener nuevas variables. Contaremos el número de caracteres de la variable name, sin contar los espacios.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una nueva columna donde se guardaran los nombres</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">"name_sin_espacios"</span>] <span class="op">=</span> dfcat[<span class="st">"name"</span>].<span class="bu">str</span>.replace(<span class="st">' '</span>,<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora tomamos la longitud de la cadena, pero de la columna </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># que ya no tiene espacios, y creamos la nueva variable</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">"Name_Length"</span>] <span class="op">=</span> dfcat[<span class="st">"name_sin_espacios"</span>].<span class="bu">str</span>.<span class="bu">len</span>() </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una nueva variable para tener control de la cantidad</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># de palabras que tiene el nombre </span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">"words_name"</span>] <span class="op">=</span> dfcat[<span class="st">"name"</span>].<span class="bu">str</span>.split().<span class="bu">str</span>.<span class="bu">len</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminamos la variable auxiliar que creamos</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>dfcat.drop([<span class="st">"name_sin_espacios"</span>], axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dfcat.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Como mencionamos en un paso previo, la columna name por sí sola no</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># proporciona información relevante, pero no podía ser eliminada</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># porque se usaría en este paso.</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora que ya fue usada, podemos eliminarla</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>dfcat.drop([<span class="st">"name"</span>], axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="release_date" class="level4">
<h4 class="anchored" data-anchor-id="release_date">release_date</h4>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos nuevas columnas que asumirán el valor del año,</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  mes y día de la fecha de lanzamiento</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'release_year'</span>] <span class="op">=</span> pd.DatetimeIndex(dfcat[<span class="st">'release_date'</span>]).year</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'release_month'</span>] <span class="op">=</span> pd.DatetimeIndex(dfcat[<span class="st">'release_date'</span>]).month</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'release_day'</span>] <span class="op">=</span> pd.DatetimeIndex(dfcat[<span class="st">'release_date'</span>]).day</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una columna que divida a los meses de lanzamiento</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># en base a trimestres </span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>release_trim <span class="op">=</span> []</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> <span class="bu">len</span>(dfcat[<span class="st">'release_date'</span>])</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&lt;</span> <span class="dv">4</span>):</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    release_trim.append(<span class="dv">1</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&gt;</span> <span class="dv">3</span> <span class="kw">and</span> dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&lt;</span> <span class="dv">7</span>):</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    release_trim.append(<span class="dv">2</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&gt;</span> <span class="dv">6</span> <span class="kw">and</span> dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&lt;</span> <span class="dv">10</span>):</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    release_trim.append(<span class="dv">3</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&gt;</span> <span class="dv">9</span> <span class="kw">and</span> dfcat[<span class="st">'release_date'</span>][i].month <span class="op">&lt;</span> <span class="dv">13</span>):</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    release_trim.append(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'release_trim'</span>] <span class="op">=</span> release_trim</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>dfcat.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finalmente, eliminamos la columna release_date</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> dfcat[<span class="st">'release_date'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="time_signature" class="level4">
<h4 class="anchored" data-anchor-id="time_signature">time_signature</h4>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crearemos una lista que reemplazará los valores de time signature, </span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># si valen de 0 a 3 entonces asignaremos 0; en caso contrario,</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># se asignará el valor 1</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>list_time <span class="op">=</span> []</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'time_signature'</span>][i])<span class="op">&gt;=</span><span class="dv">0</span> <span class="kw">and</span> <span class="bu">int</span>(dfcat[<span class="st">'time_signature'</span>][i])<span class="op">&lt;</span><span class="dv">4</span>):</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    list_time.append(<span class="st">'0'</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'time_signature'</span>][i])<span class="op">&gt;=</span><span class="dv">4</span>):</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    list_time.append(<span class="st">'1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> dfcat[<span class="st">'time_signature'</span>]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'time_signature'</span>] <span class="op">=</span> list_time</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>dfcat.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="popularity" class="level3">
<h3 class="anchored" data-anchor-id="popularity">Popularity</h3>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>list_pop <span class="op">=</span> []</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>size_num <span class="op">=</span> <span class="bu">len</span>(dfnum[<span class="st">'popularity'</span>])</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size_num):</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(dfnum[<span class="st">'popularity'</span>][i] <span class="op">&lt;</span> <span class="dv">40</span>):</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        list_pop.append(<span class="dv">0</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(dfnum[<span class="st">'popularity'</span>][i] <span class="op">&gt;=</span> <span class="dv">40</span>):</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>        list_pop.append(<span class="dv">1</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'list_pop'</span>] <span class="op">=</span> list_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="key" class="level3">
<h3 class="anchored" data-anchor-id="key">Key</h3>
<p>La variable key representa el centro tonal de la canción, habiéndose así 12 opciones para casi todas las canciones que existen actualmente: 0, 1, …, 10, 11 .</p>
<p>Como el <strong>círculo de quintas</strong> es un concepto musical empleado en casi todas las canciones existentes, agruparemos en 4 categorías, a los valores de key, agrupándolos de 7 en 7, ya que esto representa centros tonales lo más cercanos posibles en el círculo de quintas.</p>
<p>Como el valor 0 de <strong>key</strong> representa al centro tonal C (Do), el caso más popular entre todas las canciones del planeta, agruparemos a los valores de <strong>key</strong> vía las siguientes categorías:</p>
<p>[5, 0, 7] =&gt; 0</p>
<p>[8, 3, 10] =&gt; 1</p>
<p>[11, 6, 1] =&gt; 2</p>
<p>[2, 9, 4] =&gt; 3</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>list_key <span class="op">=</span> []</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'key'</span>][i]) <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">7</span>]):</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>        list_key.append(<span class="dv">0</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'key'</span>][i]) <span class="kw">in</span> [<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">10</span>]):</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        list_key.append(<span class="dv">1</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'key'</span>][i]) <span class="kw">in</span> [<span class="dv">11</span>, <span class="dv">6</span>, <span class="dv">1</span>]):</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        list_key.append(<span class="dv">2</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="bu">int</span>(dfcat[<span class="st">'key'</span>][i]) <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">4</span>]):</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>        list_key.append(<span class="dv">3</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>dfcat[<span class="st">'list_key'</span>] <span class="op">=</span> list_key</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar data categórica tras las transformaciones</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>dfcat.to_csv(<span class="st">"../datos/dfcat_post_trans.csv"</span>, index <span class="op">=</span> <span class="va">False</span>, sep <span class="op">=</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="analisis-de-correlación" class="level4">
<h4 class="anchored" data-anchor-id="analisis-de-correlación">Analisis de correlación</h4>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>sns.heatmap(dfnum.corr())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para la creación del modelo nos basamos en este <a href="https://www.cienciadedatos.net/documentos/py07_arboles_decision_python.html">link</a> .</p>
</section>
</section>
</section>
<section id="paso-4-data-mining" class="level1">
<h1>Paso 4: Data mining</h1>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dfcat <span class="op">=</span> pd.read_csv(<span class="vs">r'F:\2022-1\Analisis de datos\Tarea Academica\dfcat_post_trans.csv'</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>dfnum <span class="op">=</span> pd.read_csv(<span class="vs">r'F:\2022-1\Analisis de datos\Tarea Academica\dfnum_sin_outliers.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dfunion <span class="op">=</span> pd.concat([dfnum,dfcat], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminamos columnas sin informacion relevante o que no podremos usar dentro de los modelos de clasificacion</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>dfunion.drop(columns <span class="op">=</span> [<span class="st">"popularity"</span>,<span class="st">"key"</span>, <span class="st">"id"</span>, <span class="st">"id_artists"</span>, <span class="st">"release_year"</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>dfunion.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="separar-en-variable-dependiente-y-variable-independiente" class="level2">
<h2 class="anchored" data-anchor-id="separar-en-variable-dependiente-y-variable-independiente">Separar en variable dependiente y variable independiente</h2>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> dfunion[<span class="st">"list_pop"</span>]</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> dfunion[[<span class="st">'duration_ms'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'loudness'</span>, <span class="st">'speechiness'</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'acousticness'</span>, <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, <span class="st">'valence'</span>, <span class="st">'tempo'</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'explicit'</span>, <span class="st">'mode'</span>, <span class="st">'time_signature'</span>, <span class="st">'Name_Length'</span>, <span class="st">'words_name'</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'release_month'</span>, <span class="st">'release_day'</span>, <span class="st">'release_trim'</span>,<span class="st">'list_key'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sample-splitting" class="level2">
<h2 class="anchored" data-anchor-id="sample-splitting">Sample splitting</h2>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dividimos en conjunto de train, test y validation</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(x, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">100</span>, stratify<span class="op">=</span>y)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>x_train, x_val, y_train, y_val <span class="op">=</span> train_test_split(x_train, y_train, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">200</span>, stratify<span class="op">=</span>y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="balanceo-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="balanceo-de-datos">Balanceo de Datos</h2>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(y_train).value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(y_train).value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nuestra variable no está tan desbalanceada</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>nas <span class="op">=</span> pd.DataFrame(x_train.isnull().<span class="bu">sum</span>()).sort_values(<span class="dv">0</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>nas.columns <span class="op">=</span> [<span class="st">'nas'</span>]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>nas[<span class="st">'nas%'</span>] <span class="op">=</span> <span class="bu">round</span>(nas[<span class="st">'nas'</span>]<span class="op">/</span>x_train.shape[<span class="dv">0</span>], <span class="dv">2</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>nas </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No tenemos valores nulos, asi que podemos generar datos balanceados</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.combine <span class="im">import</span> SMOTETomek</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>os_us <span class="op">=</span> SMOTETomek(random_state<span class="op">=</span><span class="dv">2022</span>, sampling_strategy<span class="op">=</span><span class="st">'all'</span> ) <span class="co">#</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>x_train_smote, y_train_smote <span class="op">=</span> os_us.fit_resample(x_train, y_train)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#x_train_all_smote, y_train_all_smote = os_us.fit_resample(x_train, y_train)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>oversample <span class="op">=</span> RandomOverSampler(sampling_strategy<span class="op">=</span><span class="st">'minority'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">100</span>) <span class="co">#antes del balanceo</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">100</span>) </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_smote.value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">100</span>) <span class="co">#luego de aplicar la tecnica smote</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_smote.value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="árbol-de-clasificación-cart" class="level2">
<h2 class="anchored" data-anchor-id="árbol-de-clasificación-cart">Árbol de clasificación CART</h2>
<section id="generamos-arboles-de-decision-con-datos-balanceados-y-sin-balancear" class="level3">
<h3 class="anchored" data-anchor-id="generamos-arboles-de-decision-con-datos-balanceados-y-sin-balancear">Generamos arboles de decision con datos balanceados y sin balancear</h3>
<p>Elegimos el modelo</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creacion del modelo </span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">"gini"</span>, random_state<span class="op">=</span><span class="dv">2022</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>modelo1b <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">"gini"</span>, random_state<span class="op">=</span><span class="dv">2022</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicador gini ayuda a medir la calidad de la división de los datos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Entrenamos el modelo</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenamiento del modelo </span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>modelo1.fit(x_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenamiento del modelo </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>modelo1b.fit(x_train_smote, y_train_smote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realizamos predicciones con datos de test</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizamos predicciones con datos de test</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>y_predict_modelo1 <span class="op">=</span> modelo1.predict(x_test)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>y_predict_modelo1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizamos predicciones con datos de test</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>y_predict_modelo1b <span class="op">=</span> modelo1b.predict(x_test)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>y_predict_modelo1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se calcula el accuracy</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score,classification_report,confusion_matrix</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>accuracy_score(y_test, y_predict_modelo1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se calcula el accuracy</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score,classification_report,confusion_matrix</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>accuracy_score(y_test, y_predict_modelo1b) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>scores_res <span class="op">=</span> cross_val_score(modelo1, x_train_smote, y_train_smote, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy de los 10 folds:"</span>, scores_res)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy Mean: </span><span class="sc">{:.3f}</span><span class="st"> (std: </span><span class="sc">{:.3f}</span><span class="st">)"</span>.<span class="bu">format</span>(scores_res.mean(), scores_res.std()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>scores_res <span class="op">=</span> cross_val_score(modelo1b, x_train, y_train, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy de los 10 folds:"</span>, scores_res)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy Mean: </span><span class="sc">{:.3f}</span><span class="st"> (std: </span><span class="sc">{:.3f}</span><span class="st">)"</span>.<span class="bu">format</span>(scores_res.mean(), scores_res.std()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Matriz de confusion</p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix modelo1</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.crosstab(y_test, y_predict_modelo1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix modelo1b</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.crosstab(y_test, y_predict_modelo1b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se genera el arbol de clasificacion - modelo1</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">list</span>(y_test.unique())</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> <span class="bu">list</span>(x_train.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb102"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se genera el arbol de clasificacion - modelo1b</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">list</span>(y_test.unique())</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> <span class="bu">list</span>(x_train_smote.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Falta graficar arbol</p>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> graphviz</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>graphviz.Source(tree.export_graphviz(modelo, </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                                     feature_names <span class="op">=</span> feature_names, </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                                     class_names <span class="op">=</span> target, </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                                     filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Guardamos el modelo</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>pickle.dump(modelo1, <span class="bu">open</span>(<span class="st">'modelo1'</span>, <span class="st">'wb'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>pickle.dump(modelo1b, <span class="bu">open</span>(<span class="st">'modelo1b'</span>, <span class="st">'wb'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realizamos predicciones en el modelo 1</p>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>import_modelo1 <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'modelo1'</span>, <span class="st">'rb'</span>))</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> import_modelo1.predict(x_test)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(result).value_counts() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>import_modelo1b <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'modelo1b'</span>, <span class="st">'rb'</span>))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> import_modelo1b.predict(x_test)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(result).value_counts() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="regresión-logísitica" class="level2">
<h2 class="anchored" data-anchor-id="regresión-logísitica">Regresión logísitica</h2>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Escalamiento de las variables</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> scaler.fit_transform(x_train)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> scaler.transform(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Se establecen las variables que el GridSearch va buscar</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_iter"</span>: [<span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"random_state"</span>: [<span class="dv">0</span>]</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Definimos el modelo</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> LogisticRegression()</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Se prepara el Stratified Cross-Validation</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(model2, param_grid<span class="op">=</span>parameters, cv<span class="op">=</span><span class="dv">5</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, scoring<span class="op">=</span><span class="st">"accuracy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Se entrena el modelo</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>grid_search.fit(x_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>model2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> grid_search.best_params_</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Evaluamos</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Revisamos el accuracy en el conjunto de prueba</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>model2.score(x_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizamos predicciones con datos de test</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>y_predict_modelo2 <span class="op">=</span> model2.predict(x_test)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>y_predict_modelo2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix modelo1</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.crosstab(y_test, y_predict_modelo2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="análisis-de-los-modelos" class="level2">
<h2 class="anchored" data-anchor-id="análisis-de-los-modelos">Análisis de los modelos</h2>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> indicadores(TP, FP, TN, FN):</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    Sensibility <span class="op">=</span> TP<span class="op">/</span>(TP<span class="op">+</span>FN)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( <span class="st">'Sensibilidad es:'</span>,Sensibility)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    Specificity <span class="op">=</span> TN<span class="op">/</span>(TN<span class="op">+</span>FP)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Especificidad es:'</span>, Specificity)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    Precision <span class="op">=</span> TP<span class="op">/</span>(TP<span class="op">+</span>FP)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Precision es:'</span>, Precision)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    Recall <span class="op">=</span> TP<span class="op">/</span>(TP<span class="op">+</span>FN)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Recall es:'</span>, Recall)</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    F1 <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>(Precision<span class="op">*</span>Recall)<span class="op">/</span>(Precision<span class="op">+</span>Recall)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'F1 es:'</span>, F1)</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Sensibility, Specificity, Precision, Recall, F1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="modelo-de-regresión-logística" class="level3">
<h3 class="anchored" data-anchor-id="modelo-de-regresión-logística">Modelo de regresión logística</h3>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>modelo_logit <span class="op">=</span> indicadores(<span class="dv">17421</span>, <span class="dv">10087</span>, <span class="dv">97156</span>, <span class="dv">21987</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>modelo_logit</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibility, Specificity, Precision, Recall, F1 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb119"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Revisamos el accuracy en el conjunto de prueba</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>model2.score(x_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelo-de-árbol-de-clasificación-cart-sin-balanceo-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="modelo-de-árbol-de-clasificación-cart-sin-balanceo-de-datos">Modelo de árbol de clasificación CART sin balanceo de datos</h3>
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix modelo1</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.crosstab(y_test, y_predict_modelo1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicadores(TP, FP, TN, FN)</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>modelo_arbol_cart_nobal <span class="op">=</span> indicadores(<span class="dv">20437</span>, <span class="dv">20077</span>, <span class="dv">87166</span>, <span class="dv">18971</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se calcula el accuracy</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score,classification_report,confusion_matrix</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>accuracy_score(y_test, y_predict_modelo1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelo-de-árbol-de-clasificación-cart-con-balanceo-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="modelo-de-árbol-de-clasificación-cart-con-balanceo-de-datos">Modelo de árbol de clasificación CART con balanceo de datos</h3>
<div class="cell">
<div class="sourceCode" id="cb123"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix modelo1</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.crosstab(y_test, y_predict_modelo1b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicadores(TP, FP, TN, FN)</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>modelo_arbol_card_balanc <span class="op">=</span> indicadores(<span class="dv">21980</span>, <span class="dv">23701</span>, <span class="dv">83542</span>, <span class="dv">17428</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se calcula el accuracy</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score,classification_report,confusion_matrix</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>accuracy_score(y_test, y_predict_modelo1b) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
</section>
</section>
</main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>